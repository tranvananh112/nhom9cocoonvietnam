<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Dashboard - Cocoon">
    <title>Admin Dashboard - Cocoon</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-container">
            <a href="index.html" class="logo">
                <span>üåø</span>
                <div class="logo-text">
                    <strong>The Cocoon</strong>
                    <small>ORIGINAL VIETNAM</small>
                </div>
            </a>
            <nav>
                <a href="index.html">Trang Ch·ªß</a>
                <button class="btn btn-small" onclick="logout()" style="background: #f44336;">ƒêƒÉng Xu·∫•t</button>
            </nav>
        </div>
    </header>

    <div id="loginForm" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background: white; padding: 40px; border-radius: 10px; width: 90%; max-width: 400px;">
            <h2 style="margin-bottom: 30px; text-align: center; color: #8B6F47;">ƒêƒÉng Nh·∫≠p Admin</h2>
            <input type="password" id="adminPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 1em; margin-bottom: 20px;">
            <button class="btn" onclick="adminLogin()" style="width: 100%;">ƒêƒÉng Nh·∫≠p</button>
        </div>
    </div>

    <div id="adminContent" style="display: none;">
        <div class="container" style="margin-top: 40px; margin-bottom: 60px;">
            <h2 style="margin-bottom: 40px;">Dashboard Admin</h2>

            <!-- Statistics -->
            <div class="features-grid" style="margin-bottom: 40px;">
                <div class="feature-card" style="text-align: center;">
                    <div style="font-size: 2.5em; color: #D4AF37; margin-bottom: 10px;">üìä</div>
                    <h3>T·ªïng ƒê∆°n H√†ng</h3>
                    <p id="totalOrders" style="font-size: 1.8em; color: #8B6F47; font-weight: bold;">0</p>
                </div>
                <div class="feature-card" style="text-align: center;">
                    <div style="font-size: 2.5em; color: #4CAF50; margin-bottom: 10px;">üí∞</div>
                    <h3>T·ªïng Doanh Thu</h3>
                    <p id="totalRevenue" style="font-size: 1.8em; color: #4CAF50; font-weight: bold;">0ƒë</p>
                </div>
                <div class="feature-card" style="text-align: center;">
                    <div style="font-size: 2.5em; color: #2196F3; margin-bottom: 10px;">üë•</div>
                    <h3>T·ªïng Kh√°ch H√†ng</h3>
                    <p id="totalCustomers" style="font-size: 1.8em; color: #2196F3; font-weight: bold;">0</p>
                </div>
                <div class="feature-card" style="text-align: center;">
                    <div style="font-size: 2.5em; color: #FF9800; margin-bottom: 10px;">‚è≥</div>
                    <h3>Ch·ªù X√°c Nh·∫≠n</h3>
                    <p id="pendingOrders" style="font-size: 1.8em; color: #FF9800; font-weight: bold;">0</p>
                </div>
            </div>

            <!-- Orders Table -->
            <h3 style="margin-bottom: 20px; color: #8B6F47;">Danh S√°ch ƒê∆°n H√†ng</h3>
            <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);">
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">
                                <th style="padding: 15px; text-align: left;">M√£ ƒêH</th>
                                <th style="padding: 15px; text-align: left;">Kh√°ch H√†ng</th>
                                <th style="padding: 15px; text-align: left;">ƒêi·ªán Tho·∫°i</th>
                                <th style="padding: 15px; text-align: right;">T·ªïng Ti·ªÅn</th>
                                <th style="padding: 15px; text-align: center;">Tr·∫°ng Th√°i</th>
                                <th style="padding: 15px; text-align: center;">H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Order Details Modal -->
            <div id="orderModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 999;">
                <div style="background: white; padding: 40px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="margin-bottom: 20px; color: #8B6F47;">Chi Ti·∫øt ƒê∆°n H√†ng</h2>
                    <div id="orderModalContent"></div>
                    <button class="btn" onclick="closeOrderModal()" style="margin-top: 20px; width: 100%;">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-bottom">
            <p>&copy; 2025 Cocoon - M·ªπ ph·∫©m Thu·∫ßn Chay. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        const ADMIN_PASSWORD = 'cocoon2025';
        let isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                isAdminLoggedIn = true;
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminData();
            } else {
                alert('M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng');
            }
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'index.html';
        }

        function loadAdminData() {
            const orders = JSON.parse(localStorage.getItem('cocoon_orders') || '[]');
            
            // Calculate statistics
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, o) => sum + o.total, 0);
            const uniqueCustomers = new Set(orders.map(o => o.customer.phone)).size;
            const pendingOrders = orders.filter(o => o.status === 'pending').length;

            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalRevenue').textContent = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(totalRevenue);
            document.getElementById('totalCustomers').textContent = uniqueCustomers;
            document.getElementById('pendingOrders').textContent = pendingOrders;

            // Render orders table
            const table = document.getElementById('ordersTable');
            table.innerHTML = '';

            orders.forEach(order => {
                const row = `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 15px;"><strong>${order.id}</strong></td>
                        <td style="padding: 15px;">${order.customer.name}</td>
                        <td style="padding: 15px;">${order.customer.phone}</td>
                        <td style="padding: 15px; text-align: right; font-weight: bold; color: #D4AF37;">${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(order.total)}</td>
                        <td style="padding: 15px; text-align: center;">
                            <select onchange="updateOrderStatus('${order.id}', this.value)" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 3px;">
                                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>‚è≥ Ch·ªù x√°c nh·∫≠n</option>
                                <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>‚úì ƒê√£ x√°c nh·∫≠n</option>
                                <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>üì¶ ƒêang giao</option>
                                <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>‚úì ƒê√£ giao</option>
                            </select>
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <button class="btn btn-small" onclick="viewOrderDetails('${encodeURIComponent(JSON.stringify(order))}')">Chi ti·∫øt</button>
                        </td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }

        function updateOrderStatus(orderId, newStatus) {
            let orders = JSON.parse(localStorage.getItem('cocoon_orders') || '[]');
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                localStorage.setItem('cocoon_orders', JSON.stringify(orders));
                loadAdminData();
            }
        }

        function viewOrderDetails(encodedOrder) {
            const order = JSON.parse(decodeURIComponent(encodedOrder));
            let itemsHtml = '';
            order.items.forEach(item => {
                itemsHtml += `
                    <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee;">
                        <div>${item.name} x${item.quantity}</div>
                        <div>${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(item.price * item.quantity)}</div>
                    </div>
                `;
            });

            const html = `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #8B6F47;">Th√¥ng Tin Kh√°ch H√†ng</h4>
                    <p><strong>T√™n:</strong> ${order.customer.name}</p>
                    <p><strong>ƒêi·ªán tho·∫°i:</strong> ${order.customer.phone}</p>
                    <p><strong>ƒê·ªãa ch·ªâ:</strong> ${order.customer.address}</p>
                    <p><strong>Email:</strong> ${order.customer.email || 'N/A'}</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #8B6F47;">S·∫£n Ph·∫©m</h4>
                    ${itemsHtml}
                </div>
                <div style="background: #f0f0f0; padding: 15px; border-radius: 5px;">
                    <p style="text-align: right; font-weight: bold; color: #8B6F47;">T·ªïng: ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(order.total)}</p>
                    <p style="text-align: right; font-size: 0.9em; color: #666;">Ph∆∞∆°ng th·ª©c: ${order.paymentMethod === 'cod' ? 'COD' : 'Momo'}</p>
                </div>
            `;

            document.getElementById('orderModalContent').innerHTML = html;
            document.getElementById('orderModal').style.display = 'flex';
        }

        function closeOrderModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        // Check login status on page load
        if (isAdminLoggedIn) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            loadAdminData();
        } else {
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('adminContent').style.display = 'none';
        }

        // Refresh data every 5 seconds
        setInterval(() => {
            if (isAdminLoggedIn) loadAdminData();
        }, 5000);
    </script>
</body>
</html>
